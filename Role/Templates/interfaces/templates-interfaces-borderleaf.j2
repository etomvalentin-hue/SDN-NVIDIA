#Fichier Template: templates/interfaces/borderleaf.j2

# Border Leaf {{ hostname }} - Interfaces

source /etc/network/interfaces.d/*.intf

auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp
    vrf mgmt

auto mgmt
iface mgmt
    address {{ mgmt_vrf_ip }}
    address {{ mgmt_vrf_ipv6 }}
    vrf-table auto

auto lo
iface lo
    address {{ loopback_ip }}

##### UNDERLAY #####
{% for intf in spine_interfaces %}
auto {{ intf.name }}
iface {{ intf.name }}
    alias {{ intf.description }}
{% endfor %}

##### VRF CONFIGURATION #####
auto {{ evpn_vrf.name }}
iface {{ evpn_vrf.name }}
    vrf-table auto

auto {{ internet_vrf.name }}
iface {{ internet_vrf.name }}
    vrf-table auto

##### EXTERNAL CONNECTIONS #####
{% for fw_intf in firewall_interfaces %}
auto {{ fw_intf.name }}
iface {{ fw_intf.name }}
    address {{ fw_intf.ip }}
    {% if fw_intf.vrf != "default" %}vrf {{ fw_intf.vrf }}{% endif %}
{% endfor %}

{% for router_intf in router_interface %}
auto {{ router_intf.name }}
iface {{ router_intf.name }}
    address {{ router_intf.ip }}
    vrf {{ router_intf.vrf }}
{% endfor %}

##### VXLAN L3VNI #####
auto vxlan{{ evpn_vrf.l3vni }}
iface vxlan{{ evpn_vrf.l3vni }}
    vxlan-id {{ evpn_vrf.l3vni }}
    mtu {{ overlay_mtu }}
    vxlan-local-tunnelip {{ vxlan_local_tunnelip }}
    vrf {{ evpn_vrf.name }}